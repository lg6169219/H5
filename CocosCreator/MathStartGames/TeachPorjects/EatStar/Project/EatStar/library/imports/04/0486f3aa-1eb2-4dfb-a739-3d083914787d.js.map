{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\Game.js"],"names":["Player","require","ScoreFX","Star","Game","cc","Class","extends","Component","properties","starPrefab","default","type","Prefab","boomPrefab","scoreFXPrefab","maxStarDuration","minStarDuration","player","scoreDisplay","Label","lifeDisplay","scoreAudio","AudioClip","boomAudio","btnNode","Node","startBgNode","controlHintLabel","keyboardHint","multiline","touchHint","onLoad","groundY","currentStar","currentStarX","currentBoom","currentBoomX","timer","starDuration","enabled","hintText","sys","isMobile","string","starPool","NodePool","boomPool","scorePool","globalVar","life_count","lifeCount","sendRequest","console","log","requestObj","status","sendMessage","obj","parent","iframeEvent","start","self","window","goodsSum","onStartGame","resetScore","showLife","active","startMoveAt","v2","changePlayerSize","score","s","getComponent","Sprite","spawnNewStar","randomwCreateBoom","newStar","size","get","instantiate","node","addChild","setPosition","getNewStarPosition","init","startTimer","despawnStar","star","put","despawnBoom","getNewBoomPosition","Math","random","width","randX","randY","jumpHeight","max","maxX","x","abs","min","randomVal","spawnNewBoom","newBoom","gainLife","pos","gameOver","toString","gainScore","fx","spawnScoreFX","play","audioEngine","playEffect","despawnScoreFX","scoreFX","update","dt","sendEndRequest","finalScore","stopMove","destroy","director","loadScene","scheduleOnce"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["const Player = require('Player');\nconst ScoreFX = require('ScoreFX');\nconst Star = require('Star');\n\nvar Game = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // 这个属性引用了星星预制资源\n        starPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        boomPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        scoreFXPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        // 星星产生后消失时间的随机范围\n        maxStarDuration: 0,\n        minStarDuration: 0,\n        // // 地面节点，用于确定星星生成的高度\n        // ground: {\n        //     default: null,\n        //     type: cc.Node\n        // },\n        // player 节点，用于获取主角弹跳的高度，和控制主角行动开关\n        player: {\n            default: null,\n            type: Player\n        },\n        // score label 的引用\n        scoreDisplay: {\n            default: null,\n            type: cc.Label\n        },\n        // life label 的引用\n        lifeDisplay: {\n            default: null,\n            type: cc.Label\n        },\n        // 得分音效资源\n        scoreAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n        // 爆炸音效资源\n        boomAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n        btnNode: {\n            default: null,\n            type: cc.Node\n        },\n        startBgNode: {\n            default: null,\n            type: cc.Node\n        },\n        controlHintLabel: {\n            default: null,\n            type: cc.Label\n        },\n        keyboardHint: {\n            default: '',\n            multiline: true\n        },\n        touchHint: {\n            default: '',\n            multiline: true\n        },\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        // 获取地平面的 y 轴坐标\n        this.groundY = -350;\n\n        // store last star's x position\n        this.currentStar = null;\n        this.currentStarX = 0;\n\n        this.currentBoom = null;\n        this.currentBoomX = 0;\n\n        // 初始化计时器\n        this.timer = 0;\n        this.starDuration = 0;\n\n        // is showing menu or running game\n        this.enabled = false;\n\n        // initialize control hint\n        var hintText = cc.sys.isMobile ? this.touchHint : this.keyboardHint;\n        this.controlHintLabel.string = hintText;\n\n        // initialize star and score pool\n        this.starPool = new cc.NodePool('Star');\n        this.boomPool = new cc.NodePool('Boom');\n        this.scorePool = new cc.NodePool('ScoreFX');\n\n        var globalVar = require(\"GlobalVar\");\n        this.life_count = globalVar.lifeCount;\n    },\n\n    // iframe通信\n    sendRequest(){\n        console.log(\"==========内部request\");\n        var requestObj = {\n            status:0,\n            type:\"call\",\n        }\n        this.sendMessage(requestObj);\n    },\n    sendMessage(obj){\n        parent.iframeEvent(obj);\n    },\n\n    start: function() {\n        var self = this;\n        window.iframeEvent = function(obj){\n            console.log(\"内部界面接收的消息BB\");\n            console.log(obj);\n            if (obj.goodsSum){\n                var globalVar = require('GlobalVar');\n                globalVar.lifeCount = obj.goodsSum;\n                self.life_count = globalVar.lifeCount;\n            }\n        }\n        this.sendRequest();\n    },\n    onStartGame: function () {\n        // 初始化计分\n        this.resetScore();\n        this.showLife();\n        // set game state to running\n        this.enabled = true;\n        // set button and gameover text out of screen\n        this.btnNode.active = false;\n        this.startBgNode.active = false;\n        // reset player position and move speed\n        this.player.startMoveAt(cc.v2(0, this.groundY));\n        // 检查是否更新玩家的体型和游戏难度\n        this.player.changePlayerSize(this.score);\n\n        var s = this.player.getComponent(cc.Sprite);\n        s.enabled = false;\n\n        // spawn star\n        this.spawnNewStar();\n        // 地雷\n        this.randomwCreateBoom();\n    },\n\n    spawnNewStar: function() {\n        var newStar = null;\n        // 使用给定的模板在场景中生成一个新节点\n        if (this.starPool.size() > 0) {\n            newStar = this.starPool.get(this); // this will be passed to Star's reuse method\n        } else {\n            newStar = cc.instantiate(this.starPrefab);\n        }\n        // 将新增的节点添加到 Canvas 节点下面\n        this.node.addChild(newStar);\n        // 为星星设置一个随机位置\n        newStar.setPosition(this.getNewStarPosition());\n        // pass Game instance to star\n        newStar.getComponent('Star').init(this);\n        // start star timer and store star reference\n        this.startTimer();\n        this.currentStar = newStar;\n    },\n\n    despawnStar (star) {\n        this.starPool.put(star);\n        this.spawnNewStar();\n        this.despawnBoom();\n    },\n\n    getNewBoomPosition: function () {\n        // if there's no star, set a random x pos\n        if (!this.currentBoom) {\n            this.currentBoomX = (Math.random() - 0.5) * 2 * this.node.width/2;\n        }\n        var randX = 0;\n        // 根据地平面位置和主角跳跃高度，随机得到一个星星的 y 坐标\n        var randY = this.groundY + Math.random() * this.player.jumpHeight / 2;\n        randY = Math.max(randY, -300);\n        // 根据屏幕宽度和上一个星星的 x 坐标，随机得到一个新生成星星 x 坐标\n        var maxX = this.node.width/2 - 50;\n        if (this.player.node && this.player.node.x > 0){\n            randX = -Math.random() * maxX;\n        }else{\n            randX = Math.random() * maxX;\n        }\n\n        if(this.currentStarX && Math.abs(this.currentStarX - randX) < 100){\n\n            if (this.currentStarX > randX){\n                randX = randX - 100;           \n            }else{\n                randX = randX + 100;\n            }\n            randX = Math.max(randX, -maxX);\n            randX = Math.min(randX, maxX);\n        }\n        \n        // this.currentBoomX = randX;\n        // 返回地雷坐标\n        return cc.v2(randX, randY);\n    },\n\n    randomwCreateBoom : function(){\n        var randomVal = Math.random() >= 0.5 ? true : false;\n        if (randomVal){\n            this.spawnNewBoom();\n        }\n    },\n\n    spawnNewBoom: function() {\n        var newBoom = null;\n        // 使用给定的模板在场景中生成一个新节点\n        if (this.boomPool.size() > 0) {\n            newBoom = this.boomPool.get(this); // this will be passed to Star's reuse method\n        } else {\n            newBoom = cc.instantiate(this.boomPrefab);\n        }\n\n        newBoom.getComponent(cc.Sprite).enabled = true;\n\n        // 将新增的节点添加到 Canvas 节点下面\n        this.node.addChild(newBoom);\n        // 为星星设置一个随机位置\n        newBoom.setPosition(this.getNewBoomPosition());\n        // pass Game instance to star\n        newBoom.getComponent('Boom').init(this);\n        // // start star timer and store star reference\n        // this.startTimer();\n        this.currentBoom = newBoom;\n    },\n\n    despawnBoom () {\n        if (this.currentBoom){\n            this.boomPool.put(this.currentBoom);\n            this.currentBoom = null;\n        }\n\n        this.randomwCreateBoom();\n    },\n\n    startTimer: function () {\n        // get a life duration for next star\n        this.starDuration = this.minStarDuration + Math.random() * (this.maxStarDuration - this.minStarDuration);\n        this.timer = 0;\n    },\n\n    getNewStarPosition: function () {\n        // if there's no star, set a random x pos\n        if (!this.currentStar) {\n            this.currentStarX = (Math.random() - 0.5) * 2 * this.node.width/2;\n        }\n        var randX = 0;\n        // 根据地平面位置和主角跳跃高度，随机得到一个星星的 y 坐标\n        var randY = this.groundY + Math.random() * this.player.jumpHeight + 50;\n        randY = Math.max(randY, -300);\n        // 根据屏幕宽度和上一个星星的 x 坐标，随机得到一个新生成星星 x 坐标\n        var maxX = this.node.width/2 - 50;\n        if (this.currentStarX >= 0) {\n            randX = -Math.random() * maxX;\n        } else {\n            randX = Math.random() * maxX;\n        }\n        this.currentStarX = randX;\n        // 返回星星坐标\n        return cc.v2(randX, randY);\n    },\n    \n    gainLife: function (pos) {\n        this.life_count -= 1;\n        this.life_count = Math.max(0, this.life_count);\n        // 更新 lifeDisplay Label 的文字\n        this.showLife();\n\n        if (this.life_count <= 0){\n            this.gameOver();\n        }\n    },\n\n    showLife: function () {\n        this.lifeDisplay.string = this.life_count.toString();\n    },\n\n    gainScore: function (pos) {\n        this.score += 1;\n        // 检查是否更新玩家的体型和游戏难度\n        this.player.changePlayerSize(this.score);\n        // 更新 scoreDisplay Label 的文字\n        this.scoreDisplay.string = 'Score: ' + this.score.toString();\n        // 播放特效\n        var fx = this.spawnScoreFX();\n        this.node.addChild(fx.node);\n        fx.node.setPosition(pos);\n        fx.play();\n        // 播放得分音效\n        cc.audioEngine.playEffect(this.scoreAudio, false);\n    },\n\n    resetScore: function () {\n        this.score = 0;\n        this.scoreDisplay.string = 'Score: ' + this.score.toString();\n    },\n\n    spawnScoreFX: function () {\n        var fx;\n        if (this.scorePool.size() > 0) {\n            fx = this.scorePool.get();\n            return fx.getComponent('ScoreFX');\n        } else {\n            fx = cc.instantiate(this.scoreFXPrefab).getComponent('ScoreFX');\n            fx.init(this);\n            return fx;\n        }\n    },\n\n    despawnScoreFX (scoreFX) {\n        this.scorePool.put(scoreFX);\n    },\n\n    // called every frame\n    update: function (dt) {\n        // 每帧更新计时器，超过限度还没有生成新的星星\n        // 就会调用游戏失败逻辑\n        if (this.timer > this.starDuration) {\n            this.gameOver();\n            this.enabled = false;   // disable this to avoid gameOver() repeatedly\n            return;\n        }\n        this.timer += dt;\n    },\n\n    // iframe通信\n    sendEndRequest(){\n        var requestObj = {\n            status:2,\n        }\n        this.sendMessage(requestObj);\n    },\n\n    gameOver: function () {\n        var globalVar = require('GlobalVar');\n        globalVar.finalScore = this.score;\n        \n        this.player.enabled = false;\n        this.player.stopMove();\n        this.currentStar.destroy();\n        if (this.currentBoom){\n            this.currentBoom.destroy();\n            this.currentBoom = null;\n        }\n        cc.director.loadScene(\"OverScene\");\n\n        this.scheduleOnce(this.sendEndRequest, 3);\n    }\n});\n"]}