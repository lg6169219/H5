{"version":3,"sources":["GameLoader.js"],"names":["gameLoader","Object","sIsLoaded","isLoaded","load","cb","success","fail","onProgress","percent","completedCount","totalCount","start","Date","getTime","CC_DEBUG","cc","log","loader","loadResDir","item","error","resources","urls","message","length","module","exports"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAIA,aAAa,IAAIC,MAAJ,EAAjB;AACAD,WAAWE,SAAX,GAAuB,KAAvB;AACAF,WAAWG,QAAX,GAAsB,YAAY;AAC9B,WAAO,KAAKD,SAAZ;AACH,CAFD;AAGAF,WAAWI,IAAX,GAAkB,YAyBhB;AAAA,QAzByBC,EAyBzB,uEAzB8B;AAC5B;;;AAGAC,eAJ4B,qBAInB,CACR,CAL2B;;AAM5B;;;AAGAC,YAT4B,kBAStB,CACL,CAV2B;;AAW5B;;;;AAIA;;;;AAIA;;;;AAIAC,kBAvB4B,sBAuBjBC,OAvBiB,EAuBRC,cAvBQ,EAuBQC,UAvBR,EAuBmB,CAC9C;AAxB2B,KAyB9B;;AACE,QAAIC,QAAQ,IAAIC,IAAJ,GAAWC,OAAX,EAAZ;AACA,QAAIC,QAAJ,EAAc;AACVC,WAAGC,GAAH;AACH;;AAEDD,OAAGE,MAAH,CAAUC,UAAV,CACI,GADJ;AAEI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAACT,cAAD,EAAiBC,UAAjB,EAA6BS,IAA7B,EAAsC;AAClC,YAAIf,GAAGG,UAAP,EAAmB;AACfH,eAAGG,UAAH,CAAcE,iBAAiBC,UAA/B,EAA2CD,cAA3C,EAA2DC,UAA3D;AACH;AACJ,KAdL;AAeI;AACA;AACA;AACA;AACA,cAACU,KAAD,EAAQC,SAAR,EAAmBC,IAAnB,EAA4B;AACxB,YAAIF,SAAS,IAAb,EAAmB;AACf,gBAAIN,QAAJ,EAAc;AACVC,mBAAGK,KAAH,qDAAwBA,MAAMG,OAA9B;AACH;AACD,gBAAInB,GAAGE,IAAP,EAAa;AACTF,mBAAGE,IAAH;AACH;AACD;AACH;;AAED,YAAIQ,QAAJ,EAAc;AACVC,eAAGC,GAAH,mCAAmBK,UAAUG,MAA7B,8CAA8CF,KAAKE,MAAnD;AACA,gBAAIH,UAAUG,MAAV,IAAoBF,KAAKE,MAA7B,EAAqC;AACjCT,mBAAGK,KAAH;AACH;AACJ;AACD,YAAIN,QAAJ,EAAc;AACVC,eAAGC,GAAH,sEAAiC,IAAIJ,IAAJ,GAAWC,OAAX,KAAuBF,KAAxD;AACH;;AAEDZ,mBAAWE,SAAX,GAAuB,IAAvB;AACAG,WAAGC,OAAH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,KA7FL;AA+FH,CA9HD;AA+HAoB,OAAOC,OAAP,GAAiB3B,UAAjB","file":"GameLoader.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\loading_page","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nvar gameLoader = new Object();\r\ngameLoader.sIsLoaded = false;\r\ngameLoader.isLoaded = function () {\r\n    return this.sIsLoaded;\r\n};\r\ngameLoader.load = function(cb = {\r\n    /**\r\n     * 加载成功\r\n     */\r\n    success(){\r\n    },\r\n    /**\r\n     * 加载失败\r\n     */\r\n    fail(){\r\n    },\r\n    /**\r\n     * 加载进度百分比[0,1]\r\n     * percent\r\n     */\r\n    /**\r\n     * 当前完成数量\r\n     * completedCount\r\n     */\r\n    /**\r\n     * 总数量\r\n     * totalCount\r\n     */\r\n    onProgress(percent, completedCount, totalCount){\r\n    }\r\n}){\r\n    let start = new Date().getTime();\r\n    if (CC_DEBUG) {\r\n        cc.log(`>>> 开始加载所有游戏资源`);\r\n    }\r\n\r\n    cc.loader.loadResDir(\r\n        \"/\",\r\n        // 每加载一个资源都会回调这里\r\n        // 可能会连续多次次出现加载相同进度\r\n        // ps:\r\n        // 当前已经加载进度(9/34)\r\n        // 当前已经加载进度(9/34)\r\n        // completedCount 已经加载完毕的数量\r\n        // totalCount 总数量\r\n        // item 最后一个加载成功的 （官方原话：The latest item which flow out the pipeline.）\r\n        (completedCount, totalCount, item) => {\r\n            if (cb.onProgress) {\r\n                cb.onProgress(completedCount / totalCount, completedCount, totalCount);\r\n            }\r\n        },\r\n        // 当所有的资源都加载完毕的时候，或者其中一个资源加载失败的时候会立即回调下面这个方法\r\n        // error 当其中一个资源加载失败的时候，会立即回调这个方法，同时本参数携带错误描述，如果都加载成功，那么这个参数为空\r\n        // resources 所有成功加载的资源\r\n        // urls 所有加载成功的资源的URLs\r\n        (error, resources, urls) => {\r\n            if (error != null) {\r\n                if (CC_DEBUG) {\r\n                    cc.error(`>>> 有资源加载失败 ${error.message}`);\r\n                }\r\n                if (cb.fail) {\r\n                    cb.fail();\r\n                }\r\n                return;\r\n            }\r\n\r\n            if (CC_DEBUG) {\r\n                cc.log(`>>> 成功加载 ${resources.length} 个资源，对应 ${urls.length} 个资源相对路径地址`);\r\n                if (resources.length != urls.length) {\r\n                    cc.error(`>>> 资源数量和路径数量不一致，建议检查一下`);\r\n                }\r\n            }\r\n            if (CC_DEBUG) {\r\n                cc.log(`>>> 加载游戏 Resources 资源耗时${new Date().getTime() - start}ms`);\r\n            }\r\n\r\n            gameLoader.sIsLoaded = true;\r\n            cb.success();\r\n            // let gameConfigJson;\r\n            // let targetConfig = \"game_config_zh\";\r\n            // if (FBInstantAdapter.isFacebookInstantGame()) {\r\n            //     if (!FBInstantAdapter.isZh()) {\r\n            //         targetConfig = \"game_config_en\";\r\n            //     }\r\n            // }\r\n            // for (let i = 0; i < resources.length; i++) {\r\n            //     let resource = resources[i];\r\n            //     let url = urls[i];\r\n            //     if (!resource.isValid) {\r\n            //         if (CC_DEBUG) {\r\n            //             cc.error(`>>> 资源 ${resource.name}[${url}] 加载失败，当前不可用`);\r\n            //         }\r\n            //         return;\r\n            //     }\r\n            //     if (!resource.loaded) {\r\n            //         if (CC_DEBUG) {\r\n            //             cc.error(`>>> 资源 ${resource.name}[${url}] 没有成功加载`);\r\n            //         }\r\n            //         return;\r\n            //     }\r\n            //     if (resource.name == targetConfig) {\r\n            //         if (resource instanceof cc.TextAsset) {\r\n            //             gameConfigJson = JSON.parse((<cc.TextAsset>resource).text);\r\n            //         } else if (resource instanceof cc.JsonAsset) {\r\n            //             gameConfigJson = (<cc.JsonAsset>resource).json;\r\n            //         }\r\n            //     }\r\n            // }\r\n            // if (gameConfigJson == null) {\r\n            //     if (cb.fail) {\r\n            //         cb.fail();\r\n            //     }\r\n            // } else {\r\n            //     Game.init({\r\n            //         configJson: gameConfigJson,\r\n            //         success: () => {\r\n            //             if (CC_DEBUG) {\r\n            //                 cc.log(`>>> 游戏加载成功`);\r\n            //             }\r\n            //             GameLoader.sIsLoaded = true;\r\n            //             cb.success();\r\n            //         },\r\n            //         fail: () => {\r\n            //             if (cb.fail) {\r\n            //                 cb.fail();\r\n            //             }\r\n            //         }\r\n            //     });\r\n            // }\r\n        }\r\n    );\r\n}\r\nmodule.exports = gameLoader;\r\n\r\n"]}